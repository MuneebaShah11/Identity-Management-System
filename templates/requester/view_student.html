<html>
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />

    <title>Stitch Design</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="{{ url_for('static', filename='dark-mode.js') }}"></script>
  </head>
  <body>
    <div class="relative flex size-full min-h-screen flex-col bg-slate-50 group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
      <div class="layout-container flex h-full grow flex-col">
        <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#e7edf4] px-10 py-3">
          <a href="{{ url_for('requester') }}">
            <div class="w-[10.5rem] h-[6.5rem]">
              <img src="../../static/logo.png" alt="Logo" class="w-full h-full object-contain" />
            </div>
          </a>
          <div class="flex flex-1 justify-end gap-8">
            <div class="flex items-center gap-4">
              <div class="bg-[#3b82f6] text-white px-3 py-1 rounded-full text-xs font-semibold">
                Requester Portal
              </div>
            </div>
            <div class="flex items-center gap-9">
              <a class="text-[#0d141c] text-sm font-medium leading-normal" href="{{ url_for('requester') }}">Home</a>
              <a class="text-[#0d141c] text-sm font-medium leading-normal" href="{{ url_for('requester_status')}}">Requests</a>
              <a class="text-[#0d141c] text-sm font-medium leading-normal" href="{{ url_for('requester_students') }}">Students</a>
              <a class="text-[#0d141c] text-sm font-medium leading-normal" href="{{ url_for('requester_settings') }}">Settings</a>
              <a class="text-[#dc2626] text-sm font-medium leading-normal" href="{{ url_for('logout') }}">Logout</a>
            </div>
            
          </div>
        </header>
        <div class="px-40 flex flex-1 justify-center py-5">
          <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
            <div class="flex flex-wrap justify-between gap-3 p-4">
              <p class="text-[#0d141c] tracking-light text-[32px] font-bold leading-tight min-w-72">Students</p>
            </div>
            <div class="px-4 py-3">
              <form action="{{ url_for('requester_students') }}" method="get" class="flex flex-col min-w-40 h-12 w-full">
                <div class="flex w-full flex-1 items-stretch rounded-xl h-full">
                  <div
                    class="text-[#49719c] flex border-none bg-[#e7edf4] items-center justify-center pl-4 rounded-l-xl border-r-0"
                    data-icon="MagnifyingGlass"
                    data-size="24px"
                    data-weight="regular"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                      <path
                        d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"
                      ></path>
                    </svg>
                  </div>
                  <input name="q"
                    placeholder="Search by name, student ID, major, or department"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#0d141c] focus:outline-0 focus:ring-0 border-none bg-[#e7edf4] focus:border-none h-full placeholder:text-[#49719c] px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal"
                    value="{{ q or '' }}"
                  />
                </div>
              </form>
            </div>
            <div class="px-4 py-3 @container">
              <div class="flex overflow-hidden rounded-xl border border-[#cedbe8] bg-slate-50">
                <table class="flex-1">
                  <thead>
                    <tr class="bg-slate-50">
                      <th class="table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-120 px-4 py-3 text-left text-[#0d141c] w-[300px] text-sm font-medium leading-normal">Name</th>
                      <th class="table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-240 px-4 py-3 text-left text-[#0d141c] w-[150px] text-sm font-medium leading-normal">Student ID</th>
                      <th class="table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-360 px-4 py-3 text-left text-[#0d141c] w-[300px] text-sm font-medium leading-normal">Major</th>
                      <th class="table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-480 px-4 py-3 text-left text-[#0d141c] w-60 text-[#49719c] text-sm font-medium leading-normal">
                        Actions
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for student in students %}
                    <tr class="border-t border-t-[#cedbe8]">
                      <td class="table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-120 h-[72px] px-4 py-2 w-[300px] text-[#0d141c] text-sm font-normal leading-normal">
                        {{ student.full_name or student.personal_name or 'N/A' }}
                      </td>
                      <td class="table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-240 h-[72px] px-4 py-2 w-[150px] text-[#49719c] text-sm font-normal leading-normal">
                        {{ student.student_id or 'N/A' }}
                      </td>
                      <td class="table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-360 h-[72px] px-4 py-2 w-[300px] text-[#49719c] text-sm font-normal leading-normal">
                        {{ student.major or student.department or 'N/A' }}
                      </td>
                      <td class="table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-480 h-[72px] px-4 py-2 w-60 text-[#49719c] text-sm font-bold leading-normal tracking-[0.015em]">
                         <div class="flex items-center gap-2">
                           {% if student.has_pending_requests or student.has_approved_requests %}
                             <div class="flex items-center gap-1">
                               {% if student.has_pending_requests %}
                                 <div class="w-2 h-2 bg-yellow-400 rounded-full" title="Pending requests"></div>
                               {% endif %}
                               {% if student.has_approved_requests %}
                                 <div class="w-2 h-2 bg-green-400 rounded-full" title="Approved requests"></div>
                               {% endif %}
                             </div>
                           {% endif %}
                           <button type="button" class="text-[#49719c]" onclick="toggleAction('student-{{ student.user_id }}')">
                             {% if student.has_pending_requests or student.has_approved_requests %}Modify{% else %}View{% endif %}
                           </button>
                         </div>
                       </td>
                    </tr>
                                         <tr id="student-{{ student.user_id }}" class="border-t border-t-[#cedbe8] hidden">
                       <td colspan="4" class="px-6 py-4 bg-white">
                         <div class="rounded-xl border border-[#cedbe8] p-4">
                           <div class="flex items-center justify-between pb-2">
                             <p class="text-[#0d141c] text-base font-semibold leading-normal">
                               {% if student.has_pending_requests or student.has_approved_requests %}
                                 Modify access request for {{ student.full_name or student.personal_name or 'Student' }}
                               {% else %}
                                 Select information to request for {{ student.full_name or student.personal_name or 'Student' }}
                               {% endif %}
                             </p>
                             {% if student.has_pending_requests or student.has_approved_requests %}
                               <div class="flex items-center gap-2 text-sm">
                                 {% if student.has_pending_requests %}
                                   <span class="flex items-center gap-1">
                                     <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
                                     Pending
                                   </span>
                                 {% endif %}
                                 {% if student.has_approved_requests %}
                                   <span class="flex items-center gap-1">
                                     <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                     Approved
                                   </span>
                                 {% endif %}
                               </div>
                             {% endif %}
                           </div>
                           
                           {% if student.existing_requests %}
                           <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                             <p class="text-sm font-medium text-gray-700 mb-2">Current Requests:</p>
                             <div class="flex flex-wrap gap-2">
                               {% for request in student.existing_requests %}
                                 <span class="px-2 py-1 text-xs rounded-full 
                                   {% if request.status == 'pending' %}bg-yellow-100 text-yellow-800
                                   {% elif request.status == 'approved' %}bg-green-100 text-green-800
                                   {% elif request.status == 'rejected' %}bg-red-100 text-red-800
                                   {% endif %}">
                                   {{ request.requested_data.replace('_', ' ').title() }} ({{ request.status.title() }})
                                 </span>
                               {% endfor %}
                             </div>
                           </div>
                           {% endif %}
                           
                           <form class="space-y-3" method="POST" action="{{ url_for('submit_access_request') }}">
                             <input type="hidden" name="student_id" value="{{ student.user_id }}">
                             <div class="flex flex-wrap gap-6">
                               <label class="flex items-center gap-3">
                                 <input type="checkbox" name="data_points" value="personal_information" 
                                   class="h-5 w-5 rounded border-[#cedbe8] border-2"
                                   {% if 'personal_information' in student.requested_data_points %}checked{% endif %} />
                                 <span class="text-[#0d141c] text-base">Personal Information</span>
                               </label>
                               <label class="flex items-center gap-3">
                                 <input type="checkbox" name="data_points" value="academic_information" 
                                   class="h-5 w-5 rounded border-[#cedbe8] border-2"
                                   {% if 'academic_information' in student.requested_data_points %}checked{% endif %} />
                                 <span class="text-[#0d141c] text-base">Academic Information</span>
                               </label>
                               <label class="flex items-center gap-3">
                                 <input type="checkbox" name="data_points" value="contact_information" 
                                   class="h-5 w-5 rounded border-[#cedbe8] border-2"
                                   {% if 'contact_information' in student.requested_data_points %}checked{% endif %} />
                                 <span class="text-[#0d141c] text-base">Contact Information</span>
                               </label>
                               <label class="flex items-center gap-3">
                                 <input type="checkbox" name="data_points" value="additional_information" 
                                   class="h-5 w-5 rounded border-[#cedbe8] border-2"
                                   {% if 'additional_information' in student.requested_data_points %}checked{% endif %} />
                                 <span class="text-[#0d141c] text-base">Additional Information</span>
                               </label>
                             </div>
                             <div class="pt-2 flex justify-between items-center">
                               <div>
                                 {% if student.has_approved_requests %}
                                   <a href="{{ url_for('view_approved_data', student_id=student.user_id) }}" 
                                      class="h-9 px-4 rounded-full bg-green-600 text-white text-sm flex items-center hover:bg-green-700">
                                     View Approved Data
                                   </a>
                                 {% endif %}
                               </div>
                               <div class="flex gap-3">
                                 <button type="button" class="h-9 px-4 rounded-full bg-[#e7edf4] text-[#0d141c] text-sm" onclick="toggleAction('student-{{ student.user_id }}')">Cancel</button>
                                 <button type="submit" class="h-9 px-4 rounded-full bg-[#0b79ee] text-slate-50 text-sm flex items-center">
                                   {% if student.has_pending_requests or student.has_approved_requests %}Update Request{% else %}Request Access{% endif %}
                                 </button>
                               </div>
                             </div>
                           </form>
                         </div>
                       </td>
                     </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              <style>
                          @container(max-width:120px){.table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-120{display: none;}}
                @container(max-width:240px){.table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-240{display: none;}}
                @container(max-width:360px){.table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-360{display: none;}}
                @container(max-width:480px){.table-644a06b6-dc8c-44a7-a1d3-2918734140f0-column-480{display: none;}}
              </style>
              <script>
                function toggleAction(id){
                  var row = document.getElementById(id);
                  if(!row) return;
                  // Hide any other open action rows
                  document.querySelectorAll('tr[id^="student-"]').forEach(function(el){
                    if(el.id !== id){ el.classList.add('hidden'); }
                  });
                  row.classList.toggle('hidden');
                }
              </script>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
